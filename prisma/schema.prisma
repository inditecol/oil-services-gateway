generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["clientes", "configuracion", "inventario", "reportes", "turnos", "usuarios", "ventas"]
}

model Empresa {
  id                String       @id @default(cuid())
  rut               String       @unique
  razonSocial       String
  nombreComercial   String?
  nombre            String
  direccion         String
  ciudad            String
  provincia         String?
  pais              String       @default("Perú")
  codigoPostal      String?
  telefono          String?
  telefonoMovil     String?
  email             String?      @unique
  sitioWeb          String?
  logo              String?
  sector            String?
  tipoEmpresa       String?
  fechaConstitucion DateTime?
  activo            Boolean      @default(true)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  puntosVenta       PuntoVenta[]
  usuarios          Usuario[]

  @@map("empresas")
  @@schema("configuracion")
}

model PuntoVenta {
  id                   String             @id @default(cuid())
  codigo               String             @unique
  nombre               String
  descripcion          String?
  direccion            String
  ciudad               String
  provincia            String?
  pais                 String             @default("Perú")
  codigoPostal         String?
  telefono             String?
  telefonoMovil        String?
  email                String?
  horarioApertura      String?
  horarioCierre        String?
  diasAtencion         String[]
  coordenadasGPS       String?
  tipoEstacion         String?
  serviciosAdicionales String[]
  capacidadMaxima      Int?
  fechaApertura        DateTime?
  activo               Boolean            @default(true)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  empresaId            String
  empresa              Empresa            @relation(fields: [empresaId], references: [id])
  surtidores           Surtidor[]
  tanques              Tanque[]
  inventarioActual     InventarioActual[]
  ventasDiarias        VentaDiaria[]
  turnos               Turno[]
  ventas               Venta[]
  usuarios             Usuario[]          @relation("PuntoVentaToUsuario")
  entradasInventario   EntradaInventario[] // Relación con entradas de inventario
  historialVentasProductos HistorialVentasProductos[]
  productos Producto[]
  caja                 Caja?

  @@map("puntos_venta")
  @@schema("configuracion")
}

model Rol {
  id          String    @id @default(cuid())
  nombre      String    @unique
  descripcion String?
  permisos    String[]
  activo      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  usuarios    Usuario[]

  @@map("roles")
  @@schema("usuarios")
}

model Usuario {
  id                String             @id @default(cuid())
  tipoDeDocumento   String
  numeroDeIdentificacion BigInt
  email             String             @unique
  username          String             @unique
  password          String
  nombre            String
  apellido          String
  telefono          String?
  activo            Boolean            @default(true)
  emailVerified     Boolean            @default(false)
  ultimoLogin       DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  rolId             String
  empresaId         String?
  historialLecturas HistorialLectura[]
  cierresTurno      CierreTurno[]
  turnos            Turno[]
  empresa           Empresa?           @relation(fields: [empresaId], references: [id])
  rol               Rol                @relation(fields: [rolId], references: [id])
  ventas            Venta[]
  historialPrecios  HistorialPrecios[]
  puntosVenta       PuntoVenta[]       @relation("PuntoVentaToUsuario")
  historialVentasProductos HistorialVentasProductos[]

  @@map("usuarios")
  @@schema("usuarios")
}

model Turno {
  id                String             @id @default(cuid())
  fechaInicio       DateTime
  fechaFin          DateTime?
  horaInicio        String
  horaFin           String?
  observaciones     String?
  activo            Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  usuarioId         String?
  puntoVentaId      String
  cierres           CierreTurno[]
  puntoVenta        PuntoVenta         @relation(fields: [puntoVentaId], references: [id])
  usuario           Usuario?           @relation(fields: [usuarioId], references: [id])
  ventas            Venta[]
  historialVentasProductos HistorialVentasProductos[]

  @@map("turnos")
  @@schema("turnos")
}

model CierreTurno {
  id                     String                    @id @default(cuid())
  fechaCierre            DateTime                  @default(now())
  totalVentasLitros      Decimal                   @db.Decimal(12, 2)
  totalVentasGalones     Decimal                   @db.Decimal(12, 2)
  valorTotalGeneral      Decimal                   @db.Decimal(12, 2)
  // NUEVOS CAMPOS FINANCIEROS
  totalDeclarado         Decimal                   @db.Decimal(12, 2) @default(0)
  diferencia             Decimal                   @db.Decimal(12, 2) @default(0)
  totalEfectivo          Decimal                   @db.Decimal(12, 2) @default(0)
  totalTarjetas          Decimal                   @db.Decimal(12, 2) @default(0)
  totalTransferencias    Decimal                   @db.Decimal(12, 2) @default(0)
  totalOtros             Decimal                   @db.Decimal(12, 2) @default(0)
  observacionesFinancieras String?
  productosActualizados  Int                       @default(0)
  tanquesActualizados    Int                       @default(0)
  estado                 String
  errores                String[]
  advertencias           String[]
  resumenSurtidores      Json
  observacionesGenerales String?
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  turnoId                String
  usuarioId              String
  turno                  Turno                     @relation(fields: [turnoId], references: [id])
  usuario                Usuario                   @relation(fields: [usuarioId], references: [id])
  // RELACIÓN CON MÉTODOS DE PAGO
  metodosPago            CierreTurnoMetodoPago[]
  // RELACIÓN CON MOVIMIENTOS DE EFECTIVO
  movimientosEfectivo    MovimientoEfectivo[]

  @@map("cierres_turno")
  @@schema("turnos")
}

model CierreTurnoMetodoPago {
  id              String      @id @default(cuid())
  metodoPago      String      // EFECTIVO, TARJETA_CREDITO, TARJETA_DEBITO, etc. (mantener para compatibilidad)
  metodoPagoId    String?     // Nueva relación normalizada
  monto           Decimal     @db.Decimal(12, 2)
  porcentaje      Decimal     @db.Decimal(5, 2)
  observaciones   String?
  createdAt       DateTime    @default(now())
  cierreTurnoId   String
  cierreTurno     CierreTurno @relation(fields: [cierreTurnoId], references: [id], onDelete: Cascade)
  metodoPagoRel   MetodoPago? @relation(fields: [metodoPagoId], references: [id])

  @@map("cierre_turno_metodos_pago")
  @@schema("turnos")
}

model Cliente {
  id              String   @id @default(cuid())
  tipoDocumento   String
  numeroDocumento String   @unique
  nombre          String
  apellido        String?
  razonSocial     String?
  email           String?  @unique
  telefono        String?
  direccion       String?
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  ventas          Venta[]
  historialVentasProductos HistorialVentasProductos[]

  @@map("clientes")
  @@schema("clientes")
}

model Categoria {
  id          String     @id @default(cuid())
  nombre      String     @unique
  descripcion String?
  activo      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  productos   Producto[]

  @@map("categorias")
  @@schema("inventario")
}

model Producto {
  id                 String              @id @default(cuid())
  codigo             String              @unique
  nombre             String
  descripcion        String?
  unidadMedida       String
  precioCompra       Decimal             @db.Decimal(10, 2)
  precioVenta        Decimal             @db.Decimal(10, 2)
  moneda             String              @default("COP") // Código ISO de moneda (COP = Peso Colombiano)
  stockMinimo        Int                 @default(0)
  stockActual        Int                 @default(0)
  tipoProducto       String?              // Lubricante, bebida, alimento, etc
  codigoPlu          Int?                 //Codigo del producto 
  esCombustible      Boolean             @default(false)
  activo             Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  categoriaId        String
  entradasInventario EntradaInventarioProcess[]
  mangueras          MangueraSurtidor[]
  categoria          Categoria           @relation(fields: [categoriaId], references: [id])
  puntoVentaId       String?             
  puntoVenta         PuntoVenta?         @relation(fields: [puntoVentaId], references: [id])
  tanques            Tanque[]
  detallesVentas     DetalleVenta[]
  historialVentasProductos HistorialVentasProductos[]
  historialPrecios   HistorialPrecios[]

  @@map("productos")
  @@schema("inventario")
}

model HistorialPrecios {
  id                String    @id @default(cuid())
  productoId        String
  precioAnterior    Decimal   @db.Decimal(10, 2)
  precioNuevo       Decimal   @db.Decimal(10, 2)
  diferencia        Decimal   @db.Decimal(10, 2) // Diferencia absoluta
  porcentajeCambio  Decimal   @db.Decimal(5, 2)  // Porcentaje de cambio
  motivo            String?   // Motivo del cambio de precio
  observaciones     String?   // Observaciones adicionales
  fechaCambio       DateTime  @default(now())
  usuarioId         String    // Usuario que realizó el cambio
  createdAt         DateTime  @default(now())
  
  // Relaciones
  producto          Producto  @relation(fields: [productoId], references: [id], onDelete: Cascade)
  usuario           Usuario   @relation(fields: [usuarioId], references: [id])
  
  @@index([productoId, fechaCambio])
  @@index([fechaCambio])
  @@map("historial_precios")
  @@schema("inventario")
}

model Tanque {
  id                 String              @id @default(cuid())
  nombre             String
  capacidadTotal     Decimal             @db.Decimal(10, 2)
  nivelActual        Decimal             @default(0) @db.Decimal(10, 2)
  nivelMinimo        Decimal             @default(0) @db.Decimal(10, 2)
  alturaActual       Decimal             @default(0) @db.Decimal(8, 3) // Altura actual del fluido en centímetros
  diametro           Decimal?            @db.Decimal(8, 3) // En metros
  alturaMaxima       Decimal?            @db.Decimal(8, 3) // En metros  
  tipoTanque         String?             // Cilíndrico, rectangular, etc.
  unidadMedida       String              @default("GALONES") // LITROS o GALONES
  activo             Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  productoId         String
  puntoVentaId       String
  entradasInventario EntradaInventarioProcess[]
  tablaAforo         TablaAforo[]
  producto           Producto            @relation(fields: [productoId], references: [id])
  puntoVenta         PuntoVenta          @relation(fields: [puntoVentaId], references: [id])

  @@unique([puntoVentaId, nombre])
  @@map("tanques")
  @@schema("inventario")
}

model TablaAforo {
  id         String  @id @default(cuid())
  altura     Decimal @db.Decimal(8, 3) // Altura en centímetros
  volumen    Decimal @db.Decimal(12, 2) // Volumen en litros
  tanqueId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  tanque     Tanque  @relation(fields: [tanqueId], references: [id], onDelete: Cascade)

  @@unique([tanqueId, altura])
  @@index([tanqueId, altura])  // Cubre tanto búsquedas exactas como de rango
  @@map("tabla_aforo")
  @@schema("inventario")
}

model Surtidor {
  id                 String             @id @default(cuid())
  numero             String
  nombre             String
  descripcion        String?
  ubicacion          String?
  cantidadMangueras  Int                @default(1)
  activo             Boolean            @default(true)
  fechaInstalacion   DateTime?
  fechaMantenimiento DateTime?
  observaciones      String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  puntoVentaId       String
  mangueras          MangueraSurtidor[]
  puntoVenta         PuntoVenta         @relation(fields: [puntoVentaId], references: [id])

  @@unique([puntoVentaId, numero])
  @@map("surtidores")
  @@schema("inventario")
}

model MangueraSurtidor {
  id                String             @id @default(cuid())
  numero            String
  color             String?
  lecturaAnterior   Decimal            @default(0) @db.Decimal(12, 3)
  lecturaActual     Decimal            @default(0) @db.Decimal(12, 3)
  activo            Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  surtidorId        String
  productoId        String
  historialLecturas HistorialLectura[]
  producto          Producto           @relation(fields: [productoId], references: [id])
  surtidor          Surtidor           @relation(fields: [surtidorId], references: [id], onDelete: Cascade)

  @@unique([surtidorId, numero])
  @@map("mangueras_surtidor")
  @@schema("inventario")
}

model HistorialLectura {
  id              String           @id @default(cuid())
  fechaLectura    DateTime         @default(now())
  lecturaAnterior Decimal          @db.Decimal(12, 3)
  lecturaActual   Decimal          @db.Decimal(12, 3)
  cantidadVendida Decimal          @db.Decimal(12, 3)
  valorVenta      Decimal          @db.Decimal(12, 2)
  tipoOperacion   String
  observaciones   String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  mangueraId      String
  usuarioId       String?
  startTime       DateTime          
  finishTime      DateTime
  turnoId         String?
  manguera        MangueraSurtidor @relation(fields: [mangueraId], references: [id], onDelete: Cascade)
  usuario         Usuario?         @relation(fields: [usuarioId], references: [id])

  @@map("historial_lecturas")
  @@schema("inventario")
}

// Tabla simple para códigos de entrada de inventario
model EntradaInventario {
  id                     String      @id @default(cuid())
  
  // Código único del proceso de entrada
  codigoProceso          String      @unique
  
  // Información básica del proceso
  puntoVentaId           String
  tipoEntrada            String      // "compra", "transferencia", "ajuste", "descarga_carrotanque"
  responsable            String?     // Responsable del ingreso
  estado                 String      @default("PROCESANDO") // "PROCESANDO", "COMPLETADO_EXITOSAMENTE", "COMPLETADO_CON_ERRORES", "ERROR"
  
  // Fechas del proceso
  fechaInicio            DateTime    @default(now())
  fechaFin               DateTime?
  
  // Información financiera del proceso completo
  costoTotalProceso      Decimal?    @db.Decimal(12, 2)
  
  // Observaciones del proceso completo
  observacionesGenerales String?
  
  // Estadísticas del proceso
  totalMovimientos       Int         @default(0) // Cantidad de movimientos procesados
  movimientosExitosos    Int         @default(0) // Movimientos sin errores
  movimientosConError    Int         @default(0) // Movimientos con errores
  
  // Fechas de auditoría
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt
  
  // Relaciones
  puntoVenta             PuntoVenta  @relation(fields: [puntoVentaId], references: [id])
  procesos               EntradaInventarioProcess[] // Procesos específicos con este código
  
  @@map("entradas_inventario")
  @@schema("inventario")
}

// Tabla para procesos específicos de inventario con información detallada
model EntradaInventarioProcess {
  id                     String      @id @default(cuid())
  
  // Referencia al código de entrada
  entradaInventarioId    String
  
  // Información específica del producto/movimiento
  cantidad               Decimal     @db.Decimal(12, 3)
  unidadMedida           String      @default("unidades") // "litros", "galones", "unidades"
  tipoMovimiento         String      @default("entrada") // "entrada", "salida", "ajuste"
  
  // Información financiera del movimiento
  precioUnitario         Decimal?    @db.Decimal(10, 2)
  costoTotal             Decimal?    @db.Decimal(12, 2)
  
  // Información específica del producto en este movimiento
  codigoProducto         String?     // Código del producto para trazabilidad
  lote                   String?     // Número de lote específico
  fechaVencimiento       DateTime?   // Fecha de vencimiento específica
  
  // Información específica de tanques (para combustibles)
  alturaFluidoAnterior   Decimal?    @db.Decimal(8, 3) // Altura anterior en tanques (cm)
  alturaFluidoNueva      Decimal?    @db.Decimal(8, 3) // Altura nueva en tanques (cm)
  volumenCalculado       Decimal?    @db.Decimal(12, 3) // Volumen calculado por diferencia de altura
  
  // Estado y observaciones del movimiento específico
  estadoMovimiento       String      @default("COMPLETADO") // "COMPLETADO", "ERROR", "PENDIENTE"
  observaciones          String?     // Observaciones específicas de este movimiento
  mensajeError           String?     // Mensaje de error si el movimiento falló
  
  // Fecha específica del movimiento
  fechaMovimiento        DateTime    @default(now())
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt
  
  // Relaciones específicas del movimiento
  productoId             String?     // Producto específico del movimiento
  tanqueId               String?     // Tanque específico (para combustibles)
  carrotanqueId          String?     // Carrotanque específico (para descargas)
  
  // Relaciones
  entradaInventario      EntradaInventario @relation(fields: [entradaInventarioId], references: [id], onDelete: Cascade)
  producto               Producto?   @relation(fields: [productoId], references: [id])
  tanque                 Tanque?     @relation(fields: [tanqueId], references: [id])
  carrotanque            Carrotanque? @relation(fields: [carrotanqueId], references: [id])

  @@map("entradas_inventario_process")
  @@schema("inventario")
}

model Venta {
  id             String         @id @default(cuid())
  numeroVenta    String
  fechaVenta     DateTime       @default(now())
  subtotal       Decimal        @db.Decimal(10, 2)
  impuestos      Decimal        @default(0) @db.Decimal(10, 2)
  descuentos     Decimal        @default(0) @db.Decimal(10, 2)
  total          Decimal        @db.Decimal(10, 2)
  metodoPago     String
  estado         String         @default("completada")
  observaciones  String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  clienteId      String?
  usuarioId      String
  turnoId        String
  puntoVentaId   String
  detallesVentas DetalleVenta[]
  cliente        Cliente?       @relation(fields: [clienteId], references: [id])
  puntoVenta     PuntoVenta     @relation(fields: [puntoVentaId], references: [id])
  turno          Turno          @relation(fields: [turnoId], references: [id])
  usuario        Usuario        @relation(fields: [usuarioId], references: [id])

  @@unique([puntoVentaId, numeroVenta])
  @@map("ventas")
  @@schema("ventas")
}

model DetalleVenta {
  id             String   @id @default(cuid())
  cantidad       Decimal  @db.Decimal(10, 2)
  precioUnitario Decimal  @db.Decimal(10, 2)
  descuento      Decimal  @default(0) @db.Decimal(10, 2)
  subtotal       Decimal  @db.Decimal(10, 2)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  ventaId        String
  productoId     String
  producto       Producto @relation(fields: [productoId], references: [id])
  venta          Venta    @relation(fields: [ventaId], references: [id], onDelete: Cascade)

  @@map("detalles_ventas")
  @@schema("ventas")
}

model VentaDiaria {
  id                  String     @id @default(cuid())
  fecha               DateTime   @db.Date
  totalVentas         Int
  montoTotal          Decimal    @db.Decimal(12, 2)
  totalCombustible    Decimal    @db.Decimal(12, 2)
  totalProductos      Decimal    @db.Decimal(12, 2)
  ventasEfectivo      Decimal    @db.Decimal(12, 2)
  ventasTarjeta       Decimal    @db.Decimal(12, 2)
  ventasTransferencia Decimal    @db.Decimal(12, 2)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  puntoVentaId        String
  puntoVenta          PuntoVenta @relation(fields: [puntoVentaId], references: [id])

  @@unique([puntoVentaId, fecha])
  @@map("ventas_diarias")
  @@schema("ventas")
}

model InventarioActual {
  id                 String     @id @default(cuid())
  productoId         String
  stockActual        Int
  valorInventario    Decimal    @db.Decimal(12, 2)
  fechaActualizacion DateTime   @default(now())
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  puntoVentaId       String
  puntoVenta         PuntoVenta @relation(fields: [puntoVentaId], references: [id])

  @@unique([puntoVentaId, productoId])
  @@map("inventario_actual")
  @@schema("inventario")
}

model Carrotanque {
  id                 String              @id @default(cuid())
  nombre             String
  placa              String              @unique // Placa del vehículo
  capacidadTotal     Decimal             @db.Decimal(10, 2)
  nivelActual        Decimal             @default(0) @db.Decimal(10, 2)
  nivelMinimo        Decimal             @default(0) @db.Decimal(10, 2)
  alturaActual       Decimal             @default(0) @db.Decimal(8, 3) // Altura actual del fluido en centímetros
  diametro           Decimal?            @db.Decimal(8, 3) // En metros
  alturaMaxima       Decimal?            @db.Decimal(8, 3) // En metros  
  tipoCarrotanque    String?             // Tipo de carrotanque
  unidadMedida       String              @default("GALONES") // LITROS o GALONES
  activo             Boolean             @default(true)
  conductor          String?             // Nombre del conductor
  empresa            String?             // Empresa transportista
  observaciones      String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  tablaAforo         TablaAforoCarrotanque[]
  entradasInventario EntradaInventarioProcess[] // Relación con entradas de inventario

  @@map("carrotanques")
  @@schema("inventario")
}

model TablaAforoCarrotanque {
  id            String      @id @default(cuid())
  altura        Decimal     @db.Decimal(8, 3) // Altura en centímetros
  volumen       Decimal     @db.Decimal(12, 2) // Volumen en litros
  carrotanqueId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  carrotanque   Carrotanque @relation(fields: [carrotanqueId], references: [id], onDelete: Cascade)

  @@unique([carrotanqueId, altura])
  @@index([carrotanqueId, altura])
  @@map("tabla_aforo_carrotanque")
  @@schema("inventario")
}

// Tabla para métodos de pago
model MetodoPago {
  id          String   @id @default(cuid())
  codigo      String   @unique
  nombre      String
  descripcion String?
  activo      Boolean  @default(true)
  esEfectivo  Boolean  @default(false)
  esTarjeta   Boolean  @default(false)
  esDigital   Boolean  @default(false)
  orden       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  historialVentasProductos HistorialVentasProductos[]
  cierresTurnoMetodosPago CierreTurnoMetodoPago[]

  @@map("metodos_pago")
  @@schema("configuracion")
}

// Tabla única para historial de ventas de productos
model HistorialVentasProductos {
  id                String   @id @default(cuid())
  fechaVenta        DateTime
  cantidadVendida   Float
  precioUnitario    Float
  valorTotal        Float
  unidadMedida      String
  observaciones     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relaciones
  productoId        String
  producto          Producto @relation(fields: [productoId], references: [id])
  metodoPagoId      String
  metodoPago        MetodoPago @relation(fields: [metodoPagoId], references: [id])
  clienteId         String?
  cliente           Cliente? @relation(fields: [clienteId], references: [id])
  usuarioId         String
  usuario           Usuario @relation(fields: [usuarioId], references: [id])
  turnoId           String
  turno             Turno @relation(fields: [turnoId], references: [id])
  puntoVentaId      String
  puntoVenta        PuntoVenta @relation(fields: [puntoVentaId], references: [id])
  
  @@map("historial_ventas_productos")
  @@schema("ventas")
}

// Modelo para registrar todos los movimientos de efectivo
model MovimientoEfectivo {
  id                String          @id @default(cuid())
  fecha             DateTime        @default(now())
  tipo              String          // "INGRESO" o "EGRESO"
  monto             Decimal         @db.Decimal(12, 2)
  concepto          String          // Descripción del movimiento (ej: "Venta", "Pago proveedor", "Depósito banco")
  detalle           String?         // Detalle adicional del movimiento
  observaciones     String?
  
  // Relación con cierre de turno
  cierreTurnoId     String
  cierreTurno       CierreTurno    @relation(fields: [cierreTurnoId], references: [id], onDelete: Cascade)
  
  // Auditoría
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  @@index([cierreTurnoId])
  @@index([tipo])
  @@index([fecha])
  @@map("movimientos_efectivo")
  @@schema("turnos")
}

// Modelo para la caja de cada punto de venta
model Caja {
  id                String       @id @default(cuid())
  puntoVentaId      String       @unique
  saldoActual       Decimal      @default(0) @db.Decimal(12, 2) // Saldo actual en efectivo
  saldoInicial      Decimal      @default(0) @db.Decimal(12, 2) // Saldo inicial del día
  fechaUltimoMovimiento DateTime? // Fecha del último movimiento
  activa            Boolean      @default(true)
  observaciones     String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  
  puntoVenta        PuntoVenta   @relation(fields: [puntoVentaId], references: [id], onDelete: Cascade)
  
  @@map("cajas")
  @@schema("configuracion")
}
